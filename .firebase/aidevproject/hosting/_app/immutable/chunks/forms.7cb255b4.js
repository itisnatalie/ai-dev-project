import{p as E}from"./parse.bee59afc.js";import{j as v,k}from"./singletons.104e32fa.js";const A=v("invalidate_all");function T(t){return k.apply_action(t)}function L(t){const r=JSON.parse(t);return r.data&&(r.data=E(r.data)),r}function l(t,r,c){console.warn(`\`${t}\` has been deprecated in favor of \`${r}\`. \`${t}\` will be removed in a future version. (Called from ${c})`)}function u(t){return HTMLElement.prototype.cloneNode.call(t)}function H(t,r=()=>{}){if(u(t).method!=="post")throw new Error('use:enhance can only be used on <form> fields with method="POST"');const c=async({action:a,result:s,reset:o})=>{s.type==="success"&&(o!==!1&&HTMLFormElement.prototype.reset.call(t),await A()),(location.origin+location.pathname===a.origin+a.pathname||s.type==="redirect"||s.type==="error")&&T(s)};async function m(a){var b,h,y,w;if(((b=a.submitter)!=null&&b.hasAttribute("formmethod")?a.submitter.formMethod:u(t).method)!=="post")return;a.preventDefault();const o=new URL((h=a.submitter)!=null&&h.hasAttribute("formaction")?a.submitter.formAction:u(t).action),n=new FormData(t);if(u(t).enctype!=="multipart/form-data"){for(const e of n.values())if(e instanceof File){console.warn('Your form contains <input type="file"> fields, but is missing the `enctype="multipart/form-data"` attribute. This will lead to inconsistent behavior between enhanced and native forms. For more details, see https://github.com/sveltejs/kit/issues/9819. This will be upgraded to an error in v2.0.');break}}const f=(y=a.submitter)==null?void 0:y.getAttribute("name");f&&n.append(f,((w=a.submitter)==null?void 0:w.getAttribute("value"))??"");const d=new AbortController;let p=!1;const g=await r({action:o,cancel:()=>p=!0,controller:d,get data(){return l("data","formData","use:enhance submit function"),n},formData:n,get form(){return l("form","formElement","use:enhance submit function"),t},formElement:t,submitter:a.submitter})??c;if(p)return;let i;try{const e=await fetch(o,{method:"POST",headers:{accept:"application/json","x-sveltekit-action":"true"},cache:"no-store",body:n,signal:d.signal});i=L(await e.text()),i.type==="error"&&(i.status=e.status)}catch(e){if((e==null?void 0:e.name)==="AbortError")return;i={type:"error",error:e}}g({action:o,get data(){return l("data","formData","callback returned from use:enhance submit function"),n},formData:n,get form(){return l("form","formElement","callback returned from use:enhance submit function"),t},formElement:t,update:e=>c({action:o,result:i,reset:e==null?void 0:e.reset}),result:i})}return HTMLFormElement.prototype.addEventListener.call(t,"submit",m),{destroy(){HTMLFormElement.prototype.removeEventListener.call(t,"submit",m)}}}export{H as e};
